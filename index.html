<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Ordina la tua pizza üçï</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { 
      font-family: 'Garamond', serif; 
      margin: 0; 
      padding: 0; 
      background-color: #fff3e0; 
      color: #333; 
    }

    header {
      background-color: #d32f2f;
      text-align: center;
      padding: 20px 10px;
    }

    header img.stemma {
      max-width: 120px;
    }

    main {
      max-width: 600px;
      margin: 30px auto;
      padding: 0 20px;
    }

    form {
      background-color: #fff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    label { display: block; margin-top: 15px; }
    input, select, textarea, button { 
      width: 100%; 
      padding: 10px; 
      margin-top: 5px; 
      font-size: 16px; 
      border-radius: 5px; 
      border: 1px solid #ccc; 
      box-sizing: border-box; 
      font-family: 'Garamond', serif;
    }
    button { background-color: #d32f2f; color: white; border: none; cursor: pointer; transition: background 0.3s; font-size: 18px; }
    button:hover { background-color: #b71c1c; }

    .hidden { display: none; }

    .pizza-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #fff3e0;
      border: 1px solid #d32f2f;
      border-radius: 10px;
      padding: 10px 15px;
      margin-bottom: 12px;
      transition: transform 0.2s;
    }
    .pizza-item:hover { transform: translateY(-2px); }

    .pizza-left { display: flex; align-items: flex-start; }
    .pizza-left-top { display: flex; align-items: flex-start; }

    .pizza-left-top input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      cursor: pointer;
      margin-top: 4px;
    }

    .pizza-info strong { font-size: 18px; color: #d32f2f; }
    .pizza-info span { font-size: 14px; color: #555; margin-top: 2px; display: block; }

    .pizza-qty input[type="number"] {
      width: 60px;
      font-size: 16px;
      padding: 5px;
    }

    @media (max-width: 500px) {
      .pizza-item { flex-direction: row; align-items: center; }
      .pizza-left { flex: 1; }
      .pizza-qty { margin-left: 10px; }
    }
  </style>
</head>
<body>

<header>
  <img src="stemmaAlfiero.png" alt="Stemma Pizzeria Alfiero" class="stemma">
</header>

<main>
  <form id="ordine" action="https://formspree.io/f/myzpablp" method="POST">

    <label>Nome:
      <input type="text" id="nome" required>
    </label>

    <label>Telefono:
      <input type="text" id="telefono" required>
    </label>

    <label>Tipo di ordine:
      <select id="tipo_ordine" required>
        <option value="asporto">Asporto</option>
        <option value="domicilio">Domicilio</option>
      </select>
    </label>

    <div id="consegna_extra" class="hidden">
      <label>Zona di consegna:
        <select id="zona">
          <option value="marina_di_carrara">Marina di Carrara</option>
          <option value="carrara">Carrara</option>
          <option value="marina_di_massa">Marina di Massa</option>
          <option value="massa">Massa</option>
          <option value="forte_dei_marmi">Forte dei Marmi</option>
        </select>
      </label>

      <label>Indirizzo:
        <input type="text" id="indirizzo">
      </label>
    </div>

    <label>Orario:
      <select id="orario">
        <option value="19:15">19:15</option>
        <option value="20:00">20:00</option>
        <option value="21:00">21:00</option>
      </select>
    </label>

    <label>Pizze:</label>

    <div class="pizza-item">
      <div class="pizza-left">
        <div class="pizza-left-top">
          <input type="checkbox" value="Margherita">
          <div class="pizza-info">
            <strong>Margherita</strong>
            <span>Pomodoro, mozzarella</span>
          </div>
        </div>
      </div>
      <div class="pizza-qty">
        <input type="number" min="1" value="1" disabled>
      </div>
    </div>

    <div class="pizza-item">
      <div class="pizza-left">
        <div class="pizza-left-top">
          <input type="checkbox" value="Diavola">
          <div class="pizza-info">
            <strong>Diavola</strong>
            <span>Pomodoro, mozzarella, salame piccante</span>
          </div>
        </div>
      </div>
      <div class="pizza-qty">
        <input type="number" min="1" value="1" disabled>
      </div>
    </div>

    <div class="pizza-item">
      <div class="pizza-left">
        <div class="pizza-left-top">
          <input type="checkbox" value="Capricciosa">
          <div class="pizza-info">
            <strong>Capricciosa</strong>
            <span>Pomodoro, mozzarella, funghi, prosciutto, carciofi</span>
          </div>
        </div>
      </div>
      <div class="pizza-qty">
        <input type="number" min="1" value="1" disabled>
      </div>
    </div>

    <label>Note aggiuntive:
      <textarea id="note" rows="3"></textarea>
    </label>

    <!-- L‚Äôunico campo inviato a Formspree -->
    <input type="hidden" name="message" id="message">

    <button type="submit">Invia ordine</button>
  </form>
</main>

<script>
  const tipoOrdine = document.getElementById("tipo_ordine");
  const consegnaExtra = document.getElementById("consegna_extra");
  const zona = document.getElementById("zona");
  const orario = document.getElementById("orario");
  const indirizzo = document.getElementById("indirizzo");

  tipoOrdine.addEventListener("change", () => {
    if (tipoOrdine.value === "domicilio") {
      consegnaExtra.classList.remove("hidden");
      indirizzo.setAttribute("required", "required");
      aggiornaOrari();
    } else {
      consegnaExtra.classList.add("hidden");
      indirizzo.removeAttribute("required");
      resetOrariAsporto();
    }
  });

  zona.addEventListener("change", aggiornaOrari);

  function aggiornaOrari() {
    orario.innerHTML = "";
    if (zona.value === "forte_dei_marmi") {
      ["19:15", "20:00", "21:00"].forEach(h => orario.append(new Option(h,h)));
    } else {
      ["19:15", "21:00"].forEach(h => orario.append(new Option(h,h)));
    }
  }

  function resetOrariAsporto() {
    orario.innerHTML = "";
    ["19:15", "20:00", "21:00"].forEach(h => orario.append(new Option(h,h)));
  }

  document.querySelectorAll('.pizza-item input[type="checkbox"]').forEach(chk => {
    chk.addEventListener('change', function() {
      const qty = this.closest('.pizza-item').querySelector('input[type="number"]');
      qty.disabled = !this.checked;
    });
  });

  // Invio form
  const form = document.getElementById('ordine');
  form.addEventListener('submit', async function(e) {
    e.preventDefault();

    // recupero valori
    const nome = document.getElementById('nome').value;
    const telefono = document.getElementById('telefono').value;
    const indirizzoVal = document.getElementById('indirizzo')?.value || "‚Äî";
    const orarioVal = document.getElementById('orario').value;
    const note = document.getElementById('note').value;

    // Pizze scelte
    let pizze = [];
    document.querySelectorAll('.pizza-item').forEach(item => {
      const chk = item.querySelector('input[type="checkbox"]');
      const qty = item.querySelector('input[type="number"]');
      if (chk.checked) {
        pizze.push(`${chk.value} x${qty.value}`);
      }
    });

    // testo riassuntivo
    const riassunto = `Ordine Pizza
Nome: ${nome}
Telefono: ${telefono}
Indirizzo: ${indirizzoVal}
Orario: ${orarioVal}

Pizze:
${pizze.join("\n")}

Note aggiuntive:
${note}`;

    document.getElementById('message').value = riassunto;

    // invio a Formspree
    const formData = new FormData(form);
    const response = await fetch(form.action, {
      method: form.method,
      body: formData,
      headers: { 'Accept': 'application/json' }
    });

    if (response.ok) {
      window.location.href = "grazie.html";
    } else {
      alert("Errore nell'invio dell'ordine. Riprova.");
    }
  });
</script>

</body>
</html>
